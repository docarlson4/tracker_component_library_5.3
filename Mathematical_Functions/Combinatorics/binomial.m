function val=binomial(n,k)
%%BINOMIAL Evaluate the binomial coefficient n Choose k, the total number
%          of ways of choosing k items from a total selection of n where
%          the ordering of the selection does not matter.
%
%INPUTS: n A nonnegative integer indicating the number of things from which
%          one can choose.
%        k The number of items that are be chosen. This must be >=0.
%
%OUTPUTS: val The value of n Choose k.
%
%Blindly computing binomial coefficients using factorials can quickly lead
%to overflow problems. This is an implementation of the algorithm in [1]
%that has been modified to eliminate the recursion. Additionally, a test
%has been added such that if k>n, then zero is returned,  an additional
%test for large k has been added to use the identity that
%binomial(n,k)==binomial(n,n-k) to speed up the algorithm. Also, when the
%numbers get very large, a method using logarithmic factorials is used to
%ensure that the results are obtained quickly. Finally, for values of n
%less than or equal to 50, the algorithm is not used, rather the value is
%read from a table.
%
%REFERENCES:
%[1] Y. Manolopoulos, "Binomial coefficient computation: Recursion or
%    iteration?" ACM SIGCSE Bulletin, vol. 34, no. 4, pp. 65-67, Dec. 2002
%
%September 2013 David F. Crouse, Naval Research Laboratory, Washington D.C.
%(UNCLASSIFIED) DISTRIBUTION STATEMENT A. Approved for public release.

    if(k>n)
        val=0;
        return
    end

    if(k>fix(n/2))
       k=n-k; 
    end
    
    if(n<=50)
        val=binomFromTable(n,k);
    elseif(n>=800&&k>=100)
        %If k is this large for large n, then numerical precision problems
        %would have already cut off a few digits of the result, so using a
        %faster but numerically less precise method won't matter.
        val=exp(gammaln(n+1)-gammaln(k+1)-gammaln(n-k+1));
    else
        val=1;
        for m=(k-1):-1:0
           d=gcd(n-m,k-m);%GCD = greatest common divisor
           q=(k-m)/d;
           val = (val/q)*((n-m)/d);
        end
    end
end

function val=binomFromTable(n,k)
%This table holds values for all binomial terms up to binomial(50,...)
binomTable=[        1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    1;
                    2;
                    3;
                    4;
                    5;
                    6;
                    7;
                    8;
                    9;
                   10;
                   11;
                   12;
                   13;
                   14;
                   15;
                   16;
                   17;
                   18;
                   19;
                   20;
                   21;
                   22;
                   23;
                   24;
                   25;
                   26;
                   27;
                   28;
                   29;
                   30;
                   31;
                   32;
                   33;
                   34;
                   35;
                   36;
                   37;
                   38;
                   39;
                   40;
                   41;
                   42;
                   43;
                   44;
                   45;
                   46;
                   47;
                   48;
                   49;
                   50;
                    1;
                    3;
                    6;
                   10;
                   15;
                   21;
                   28;
                   36;
                   45;
                   55;
                   66;
                   78;
                   91;
                  105;
                  120;
                  136;
                  153;
                  171;
                  190;
                  210;
                  231;
                  253;
                  276;
                  300;
                  325;
                  351;
                  378;
                  406;
                  435;
                  465;
                  496;
                  528;
                  561;
                  595;
                  630;
                  666;
                  703;
                  741;
                  780;
                  820;
                  861;
                  903;
                  946;
                  990;
                 1035;
                 1081;
                 1128;
                 1176;
                 1225;
                    1;
                    4;
                   10;
                   20;
                   35;
                   56;
                   84;
                  120;
                  165;
                  220;
                  286;
                  364;
                  455;
                  560;
                  680;
                  816;
                  969;
                 1140;
                 1330;
                 1540;
                 1771;
                 2024;
                 2300;
                 2600;
                 2925;
                 3276;
                 3654;
                 4060;
                 4495;
                 4960;
                 5456;
                 5984;
                 6545;
                 7140;
                 7770;
                 8436;
                 9139;
                 9880;
                10660;
                11480;
                12341;
                13244;
                14190;
                15180;
                16215;
                17296;
                18424;
                19600;
                    1;
                    5;
                   15;
                   35;
                   70;
                  126;
                  210;
                  330;
                  495;
                  715;
                 1001;
                 1365;
                 1820;
                 2380;
                 3060;
                 3876;
                 4845;
                 5985;
                 7315;
                 8855;
                10626;
                12650;
                14950;
                17550;
                20475;
                23751;
                27405;
                31465;
                35960;
                40920;
                46376;
                52360;
                58905;
                66045;
                73815;
                82251;
                91390;
               101270;
               111930;
               123410;
               135751;
               148995;
               163185;
               178365;
               194580;
               211876;
               230300;
                    1;
                    6;
                   21;
                   56;
                  126;
                  252;
                  462;
                  792;
                 1287;
                 2002;
                 3003;
                 4368;
                 6188;
                 8568;
                11628;
                15504;
                20349;
                26334;
                33649;
                42504;
                53130;
                65780;
                80730;
                98280;
               118755;
               142506;
               169911;
               201376;
               237336;
               278256;
               324632;
               376992;
               435897;
               501942;
               575757;
               658008;
               749398;
               850668;
               962598;
              1086008;
              1221759;
              1370754;
              1533939;
              1712304;
              1906884;
              2118760;
                    1;
                    7;
                   28;
                   84;
                  210;
                  462;
                  924;
                 1716;
                 3003;
                 5005;
                 8008;
                12376;
                18564;
                27132;
                38760;
                54264;
                74613;
               100947;
               134596;
               177100;
               230230;
               296010;
               376740;
               475020;
               593775;
               736281;
               906192;
              1107568;
              1344904;
              1623160;
              1947792;
              2324784;
              2760681;
              3262623;
              3838380;
              4496388;
              5245786;
              6096454;
              7059052;
              8145060;
              9366819;
             10737573;
             12271512;
             13983816;
             15890700;
                    1;
                    8;
                   36;
                  120;
                  330;
                  792;
                 1716;
                 3432;
                 6435;
                11440;
                19448;
                31824;
                50388;
                77520;
               116280;
               170544;
               245157;
               346104;
               480700;
               657800;
               888030;
              1184040;
              1560780;
              2035800;
              2629575;
              3365856;
              4272048;
              5379616;
              6724520;
              8347680;
             10295472;
             12620256;
             15380937;
             18643560;
             22481940;
             26978328;
             32224114;
             38320568;
             45379620;
             53524680;
             62891499;
             73629072;
             85900584;
             99884400;
                    1;
                    9;
                   45;
                  165;
                  495;
                 1287;
                 3003;
                 6435;
                12870;
                24310;
                43758;
                75582;
               125970;
               203490;
               319770;
               490314;
               735471;
              1081575;
              1562275;
              2220075;
              3108105;
              4292145;
              5852925;
              7888725;
             10518300;
             13884156;
             18156204;
             23535820;
             30260340;
             38608020;
             48903492;
             61523748;
             76904685;
             95548245;
            118030185;
            145008513;
            177232627;
            215553195;
            260932815;
            314457495;
            377348994;
            450978066;
            536878650;
                    1;
                   10;
                   55;
                  220;
                  715;
                 2002;
                 5005;
                11440;
                24310;
                48620;
                92378;
               167960;
               293930;
               497420;
               817190;
              1307504;
              2042975;
              3124550;
              4686825;
              6906900;
             10015005;
             14307150;
             20160075;
             28048800;
             38567100;
             52451256;
             70607460;
             94143280;
            124403620;
            163011640;
            211915132;
            273438880;
            350343565;
            445891810;
            563921995;
            708930508;
            886163135;
           1101716330;
           1362649145;
           1677106640;
           2054455634;
           2505433700;
                    1;
                   11;
                   66;
                  286;
                 1001;
                 3003;
                 8008;
                19448;
                43758;
                92378;
               184756;
               352716;
               646646;
              1144066;
              1961256;
              3268760;
              5311735;
              8436285;
             13123110;
             20030010;
             30045015;
             44352165;
             64512240;
             92561040;
            131128140;
            183579396;
            254186856;
            348330136;
            472733756;
            635745396;
            847660528;
           1121099408;
           1471442973;
           1917334783;
           2481256778;
           3190187286;
           4076350421;
           5178066751;
           6540715896;
           8217822536;
          10272278170;
                    1;
                   12;
                   78;
                  364;
                 1365;
                 4368;
                12376;
                31824;
                75582;
               167960;
               352716;
               705432;
              1352078;
              2496144;
              4457400;
              7726160;
             13037895;
             21474180;
             34597290;
             54627300;
             84672315;
            129024480;
            193536720;
            286097760;
            417225900;
            600805296;
            854992152;
           1203322288;
           1676056044;
           2311801440;
           3159461968;
           4280561376;
           5752004349;
           7669339132;
          10150595910;
          13340783196;
          17417133617;
          22595200368;
          29135916264;
          37353738800;
                    1;
                   13;
                   91;
                  455;
                 1820;
                 6188;
                18564;
                50388;
               125970;
               293930;
               646646;
              1352078;
              2704156;
              5200300;
              9657700;
             17383860;
             30421755;
             51895935;
             86493225;
            141120525;
            225792840;
            354817320;
            548354040;
            834451800;
           1251677700;
           1852482996;
           2707475148;
           3910797436;
           5586853480;
           7898654920;
          11058116888;
          15338678264;
          21090682613;
          28760021745;
          38910617655;
          52251400851;
          69668534468;
          92263734836;
         121399651100;
                    1;
                   14;
                  105;
                  560;
                 2380;
                 8568;
                27132;
                77520;
               203490;
               497420;
              1144066;
              2496144;
              5200300;
             10400600;
             20058300;
             37442160;
             67863915;
            119759850;
            206253075;
            347373600;
            573166440;
            927983760;
           1476337800;
           2310789600;
           3562467300;
           5414950296;
           8122425444;
          12033222880;
          17620076360;
          25518731280;
          36576848168;
          51915526432;
          73006209045;
         101766230790;
         140676848445;
         192928249296;
         262596783764;
         354860518600;
                    1;
                   15;
                  120;
                  680;
                 3060;
                11628;
                38760;
               116280;
               319770;
               817190;
              1961256;
              4457400;
              9657700;
             20058300;
             40116600;
             77558760;
            145422675;
            265182525;
            471435600;
            818809200;
           1391975640;
           2319959400;
           3796297200;
           6107086800;
           9669554100;
          15084504396;
          23206929840;
          35240152720;
          52860229080;
          78378960360;
         114955808528;
         166871334960;
         239877544005;
         341643774795;
         482320623240;
         675248872536;
         937845656300;
                    1;
                   16;
                  136;
                  816;
                 3876;
                15504;
                54264;
               170544;
               490314;
              1307504;
              3268760;
              7726160;
             17383860;
             37442160;
             77558760;
            155117520;
            300540195;
            565722720;
           1037158320;
           1855967520;
           3247943160;
           5567902560;
           9364199760;
          15471286560;
          25140840660;
          40225345056;
          63432274896;
          98672427616;
         151532656696;
         229911617056;
         344867425584;
         511738760544;
         751616304549;
        1093260079344;
        1575580702584;
        2250829575120;
                    1;
                   17;
                  153;
                  969;
                 4845;
                20349;
                74613;
               245157;
               735471;
              2042975;
              5311735;
             13037895;
             30421755;
             67863915;
            145422675;
            300540195;
            601080390;
           1166803110;
           2203961430;
           4059928950;
           7307872110;
          12875774670;
          22239974430;
          37711260990;
          62852101650;
         103077446706;
         166509721602;
         265182149218;
         416714805914;
         646626422970;
         991493848554;
        1503232609098;
        2254848913647;
        3348108992991;
        4923689695575;
                    1;
                   18;
                  171;
                 1140;
                 5985;
                26334;
               100947;
               346104;
              1081575;
              3124550;
              8436285;
             21474180;
             51895935;
            119759850;
            265182525;
            565722720;
           1166803110;
           2333606220;
           4537567650;
           8597496600;
          15905368710;
          28781143380;
          51021117810;
          88732378800;
         151584480450;
         254661927156;
         421171648758;
         686353797976;
        1103068603890;
        1749695026860;
        2741188875414;
        4244421484512;
        6499270398159;
        9847379391150;
                    1;
                   19;
                  190;
                 1330;
                 7315;
                33649;
               134596;
               480700;
              1562275;
              4686825;
             13123110;
             34597290;
             86493225;
            206253075;
            471435600;
           1037158320;
           2203961430;
           4537567650;
           9075135300;
          17672631900;
          33578000610;
          62359143990;
         113380261800;
         202112640600;
         353697121050;
         608359048206;
        1029530696964;
        1715884494940;
        2818953098830;
        4568648125690;
        7309837001104;
       11554258485616;
       18053528883775;
                    1;
                   20;
                  210;
                 1540;
                 8855;
                42504;
               177100;
               657800;
              2220075;
              6906900;
             20030010;
             54627300;
            141120525;
            347373600;
            818809200;
           1855967520;
           4059928950;
           8597496600;
          17672631900;
          35345263800;
          68923264410;
         131282408400;
         244662670200;
         446775310800;
         800472431850;
        1408831480056;
        2438362177020;
        4154246671960;
        6973199770790;
       11541847896480;
       18851684897584;
       30405943383200;
                    1;
                   21;
                  231;
                 1771;
                10626;
                53130;
               230230;
               888030;
              3108105;
             10015005;
             30045015;
             84672315;
            225792840;
            573166440;
           1391975640;
           3247943160;
           7307872110;
          15905368710;
          33578000610;
          68923264410;
         137846528820;
         269128937220;
         513791607420;
         960566918220;
        1761039350070;
        3169870830126;
        5608233007146;
        9762479679106;
       16735679449896;
       28277527346376;
       47129212243960;
                    1;
                   22;
                  253;
                 2024;
                12650;
                65780;
               296010;
              1184040;
              4292145;
             14307150;
             44352165;
            129024480;
            354817320;
            927983760;
           2319959400;
           5567902560;
          12875774670;
          28781143380;
          62359143990;
         131282408400;
         269128937220;
         538257874440;
        1052049481860;
        2012616400080;
        3773655750150;
        6943526580276;
       12551759587422;
       22314239266528;
       39049918716424;
       67327446062800;
                    1;
                   23;
                  276;
                 2300;
                14950;
                80730;
               376740;
              1560780;
              5852925;
             20160075;
             64512240;
            193536720;
            548354040;
           1476337800;
           3796297200;
           9364199760;
          22239974430;
          51021117810;
         113380261800;
         244662670200;
         513791607420;
        1052049481860;
        2104098963720;
        4116715363800;
        7890371113950;
       14833897694226;
       27385657281648;
       49699896548176;
       88749815264600;
                    1;
                   24;
                  300;
                 2600;
                17550;
                98280;
               475020;
              2035800;
              7888725;
             28048800;
             92561040;
            286097760;
            834451800;
           2310789600;
           6107086800;
          15471286560;
          37711260990;
          88732378800;
         202112640600;
         446775310800;
         960566918220;
        2012616400080;
        4116715363800;
        8233430727600;
       16123801841550;
       30957699535776;
       58343356817424;
      108043253365600;
                    1;
                   25;
                  325;
                 2925;
                20475;
               118755;
               593775;
              2629575;
             10518300;
             38567100;
            131128140;
            417225900;
           1251677700;
           3562467300;
           9669554100;
          25140840660;
          62852101650;
         151584480450;
         353697121050;
         800472431850;
        1761039350070;
        3773655750150;
        7890371113950;
       16123801841550;
       32247603683100;
       63205303218876;
      121548660036300;
                    1;
                   26;
                  351;
                 3276;
                23751;
               142506;
               736281;
              3365856;
             13884156;
             52451256;
            183579396;
            600805296;
           1852482996;
           5414950296;
          15084504396;
          40225345056;
         103077446706;
         254661927156;
         608359048206;
        1408831480056;
        3169870830126;
        6943526580276;
       14833897694226;
       30957699535776;
       63205303218876;
      126410606437752;
                    1;
                   27;
                  378;
                 3654;
                27405;
               169911;
               906192;
              4272048;
             18156204;
             70607460;
            254186856;
            854992152;
           2707475148;
           8122425444;
          23206929840;
          63432274896;
         166509721602;
         421171648758;
        1029530696964;
        2438362177020;
        5608233007146;
       12551759587422;
       27385657281648;
       58343356817424;
      121548660036300;
                    1;
                   28;
                  406;
                 4060;
                31465;
               201376;
              1107568;
              5379616;
             23535820;
             94143280;
            348330136;
           1203322288;
           3910797436;
          12033222880;
          35240152720;
          98672427616;
         265182149218;
         686353797976;
        1715884494940;
        4154246671960;
        9762479679106;
       22314239266528;
       49699896548176;
      108043253365600;
                    1;
                   29;
                  435;
                 4495;
                35960;
               237336;
              1344904;
              6724520;
             30260340;
            124403620;
            472733756;
           1676056044;
           5586853480;
          17620076360;
          52860229080;
         151532656696;
         416714805914;
        1103068603890;
        2818953098830;
        6973199770790;
       16735679449896;
       39049918716424;
       88749815264600;
                    1;
                   30;
                  465;
                 4960;
                40920;
               278256;
              1623160;
              8347680;
             38608020;
            163011640;
            635745396;
           2311801440;
           7898654920;
          25518731280;
          78378960360;
         229911617056;
         646626422970;
        1749695026860;
        4568648125690;
       11541847896480;
       28277527346376;
       67327446062800;
                    1;
                   31;
                  496;
                 5456;
                46376;
               324632;
              1947792;
             10295472;
             48903492;
            211915132;
            847660528;
           3159461968;
          11058116888;
          36576848168;
         114955808528;
         344867425584;
         991493848554;
        2741188875414;
        7309837001104;
       18851684897584;
       47129212243960;
                    1;
                   32;
                  528;
                 5984;
                52360;
               376992;
              2324784;
             12620256;
             61523748;
            273438880;
           1121099408;
           4280561376;
          15338678264;
          51915526432;
         166871334960;
         511738760544;
        1503232609098;
        4244421484512;
       11554258485616;
       30405943383200;
                    1;
                   33;
                  561;
                 6545;
                58905;
               435897;
              2760681;
             15380937;
             76904685;
            350343565;
           1471442973;
           5752004349;
          21090682613;
          73006209045;
         239877544005;
         751616304549;
        2254848913647;
        6499270398159;
       18053528883775;
                    1;
                   34;
                  595;
                 7140;
                66045;
               501942;
              3262623;
             18643560;
             95548245;
            445891810;
           1917334783;
           7669339132;
          28760021745;
         101766230790;
         341643774795;
        1093260079344;
        3348108992991;
        9847379391150;
                    1;
                   35;
                  630;
                 7770;
                73815;
               575757;
              3838380;
             22481940;
            118030185;
            563921995;
           2481256778;
          10150595910;
          38910617655;
         140676848445;
         482320623240;
        1575580702584;
        4923689695575;
                    1;
                   36;
                  666;
                 8436;
                82251;
               658008;
              4496388;
             26978328;
            145008513;
            708930508;
           3190187286;
          13340783196;
          52251400851;
         192928249296;
         675248872536;
        2250829575120;
                    1;
                   37;
                  703;
                 9139;
                91390;
               749398;
              5245786;
             32224114;
            177232627;
            886163135;
           4076350421;
          17417133617;
          69668534468;
         262596783764;
         937845656300;
                    1;
                   38;
                  741;
                 9880;
               101270;
               850668;
              6096454;
             38320568;
            215553195;
           1101716330;
           5178066751;
          22595200368;
          92263734836;
         354860518600;
                    1;
                   39;
                  780;
                10660;
               111930;
               962598;
              7059052;
             45379620;
            260932815;
           1362649145;
           6540715896;
          29135916264;
         121399651100;
                    1;
                   40;
                  820;
                11480;
               123410;
              1086008;
              8145060;
             53524680;
            314457495;
           1677106640;
           8217822536;
          37353738800;
                    1;
                   41;
                  861;
                12341;
               135751;
              1221759;
              9366819;
             62891499;
            377348994;
           2054455634;
          10272278170;
                    1;
                   42;
                  903;
                13244;
               148995;
              1370754;
             10737573;
             73629072;
            450978066;
           2505433700;
                    1;
                   43;
                  946;
                14190;
               163185;
              1533939;
             12271512;
             85900584;
            536878650;
                    1;
                   44;
                  990;
                15180;
               178365;
              1712304;
             13983816;
             99884400;
                    1;
                   45;
                 1035;
                16215;
               194580;
              1906884;
             15890700;
                    1;
                   46;
                 1081;
                17296;
               211876;
              2118760;
                    1;
                   47;
                 1128;
                18424;
               230300;
                    1;
                   48;
                 1176;
                19600;
                    1;
                   49;
                 1225;
                    1;
                   50;
                    1];

idx=sub2VechInd(51,n+1,k+1);
val=binomTable(idx);
end

%LICENSE:
%
%The source code is in the public domain and not licensed or under
%copyright. The information and software may be used freely by the public.
%As required by 17 U.S.C. 403, third parties producing copyrighted works
%consisting predominantly of the material produced by U.S. government
%agencies must provide notice with such work(s) identifying the U.S.
%Government material incorporated and stating that such material is not
%subject to copyright protection.
%
%Derived works shall not identify themselves in a manner that implies an
%endorsement by or an affiliation with the Naval Research Laboratory.
%
%RECIPIENT BEARS ALL RISK RELATING TO QUALITY AND PERFORMANCE OF THE
%SOFTWARE AND ANY RELATED MATERIALS, AND AGREES TO INDEMNIFY THE NAVAL
%RESEARCH LABORATORY FOR ALL THIRD-PARTY CLAIMS RESULTING FROM THE ACTIONS
%OF RECIPIENT IN THE USE OF THE SOFTWARE.
